{% extends "base.html" %}

{% block title %}Budget - {{ building.name }} - Asset Management Platform{% endblock %}

{% block extra_css %}
<style>
    .budget-table {
        font-size: 0.9rem;
    }
    .budget-table th {
        position: sticky;
        top: 0;
        background: #fff;
        z-index: 20;
    }
    .budget-table th:first-child {
        left: 0;
        z-index: 30;
        background: #fff;
    }
    .budget-table .category-header {
        position: sticky;
        left: 0;
        background: #f8f9fa;
        font-weight: bold;
        min-width: 200px;
        z-index: 10;
        box-shadow: 2px 0 4px rgba(0,0,0,0.05);
    }
    .budget-table .subcategory-header {
        position: sticky;
        left: 0;
        background: #ffffff;
        padding-left: 2rem !important;
        font-weight: normal;
        z-index: 10;
        box-shadow: 2px 0 4px rgba(0,0,0,0.05);
    }
    .budget-table input {
        width: 100px;
        font-size: 0.85rem;
    }
    .table-container {
        overflow-x: auto;
        max-height: 600px;
    }
    .expandable-row {
        cursor: pointer;
        user-select: none;
    }
    .expandable-row:hover {
        background-color: #f8f9fa;
    }
    .expand-icon {
        transition: transform 0.3s;
        display: inline-block;
        margin-right: 0.5rem;
    }
    .expand-icon.expanded {
        transform: rotate(90deg);
    }
    .subcategory-row {
        display: none;
    }
    .subcategory-row.show {
        display: table-row;
    }
    .operating-expenses-total {
        background-color: #e9ecef;
        font-weight: 600;
    }
    .budget-table tr[data-category="Net Operating Income"] {
        background-color: #d1ecf1;
        border-top: 2px solid #0d6efd;
        font-weight: 600;
    }
    .budget-table tr[data-category="Cashflow"] {
        background-color: #d4edda;
        border-top: 2px solid #198754;
        font-weight: 600;
    }
    .budget-table tr[data-category="Net Operating Income"] .category-header,
    .budget-table tr[data-category="Cashflow"] .category-header {
        font-weight: bold;
    }
    .input-with-autofill {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    .auto-fill-btn {
        padding: 0.25rem 0.4rem;
        font-size: 0.75rem;
        line-height: 1;
        opacity: 0;
        transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        flex-shrink: 0;
        min-width: auto;
        border-radius: 0.25rem;
    }
    .subcategory-row:hover .auto-fill-btn,
    tr[data-category]:hover .auto-fill-btn {
        opacity: 1;
    }
    .auto-fill-btn:hover {
        transform: translateX(3px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .auto-fill-btn i {
        font-size: 0.9rem;
    }
    .calculated-field {
        background-color: #e9ecef !important;
        cursor: not-allowed;
        font-weight: 500;
    }
    .calculated-field:focus {
        background-color: #e9ecef !important;
        box-shadow: none;
    }
    .documents-table {
        font-size: 0.9rem;
    }
    .category-section {
        margin-bottom: 2rem;
    }
    .category-section h5 {
        background-color: #f8f9fa;
        padding: 0.75rem 1rem;
        border-left: 4px solid #0d6efd;
        margin-bottom: 1rem;
    }
    .table-warning {
        background-color: #fff3cd !important;
    }
    .table-warning:hover {
        background-color: #ffe69c !important;
    }
    .bi-check-circle-fill {
        animation: fadeIn 0.3s ease-in;
    }
    .bi-x-circle-fill {
        animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.8); }
        to { opacity: 1; transform: scale(1); }
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Entities</a></li>
        {% if entity %}
        <li class="breadcrumb-item"><a href="{{ url_for('view_entity', entity_id=entity.entity_id) }}">{{ entity.name }}</a></li>
        {% endif %}
        <li class="breadcrumb-item"><a href="{{ url_for('view_building', building_id=building.building_id) }}">{{ building.name }}</a></li>
        <li class="breadcrumb-item active">Budget & Documents</li>
    </ol>
</nav>

<div class="row mb-4">
    <div class="col">
        <h1><i class="bi bi-currency-dollar"></i> {{ building.name }}</h1>
        {% if building.address %}
        <p class="text-muted"><i class="bi bi-geo-alt"></i> {{ building.address }}</p>
        {% endif %}
    </div>
    <div class="col-auto">
        <a href="{{ url_for('view_building', building_id=building.building_id) }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back
        </a>
    </div>
</div>

<!-- Bootstrap Tabs -->
<ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'budget' %}active{% endif %}"
                id="budget-tab"
                data-bs-toggle="tab"
                data-bs-target="#budget"
                type="button"
                role="tab"
                aria-controls="budget"
                aria-selected="{% if active_tab == 'budget' %}true{% else %}false{% endif %}">
            <i class="bi bi-currency-dollar"></i> Budget
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if active_tab == 'documents' %}active{% endif %}"
                id="documents-tab"
                data-bs-toggle="tab"
                data-bs-target="#documents"
                type="button"
                role="tab"
                aria-controls="documents"
                aria-selected="{% if active_tab == 'documents' %}true{% else %}false{% endif %}">
            <i class="bi bi-file-earmark"></i> Documents
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content">
    <!-- Budget Tab -->
    <div class="tab-pane fade {% if active_tab == 'budget' %}show active{% endif %}"
         id="budget"
         role="tabpanel"
         aria-labelledby="budget-tab">

        <div class="row mb-3">
            <div class="col">
                <h3>12-Month Budget</h3>
            </div>
            <div class="col-auto">
                <a href="{{ url_for('budget_wizard', building_id=building.building_id) }}" class="btn btn-success me-2">
                    <i class="bi bi-magic"></i> Budget Wizard
                </a>
                {% if building.secondary_loan_amount and building.secondary_loan_amount > 0 %}
                <button id="updateSecondaryLoan" class="btn btn-info me-2">
                    <i class="bi bi-arrow-repeat"></i> Update Secondary Loan
                </button>
                {% endif %}
                <button id="saveBudget" class="btn btn-primary">
                    <i class="bi bi-save"></i> Save Budget
                </button>
            </div>
        </div>

<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> Edit budget values directly in the table. Click "Save Budget" when finished.
    Want to start fresh? Use the <a href="{{ url_for('budget_wizard', building_id=building.building_id) }}" class="alert-link">Budget Wizard</a> to create a new budget from scratch.
</div>

{% if not budget_by_category or (budget_by_category and 'Property Taxes' not in budget_by_category) %}
<div class="alert alert-warning">
    <i class="bi bi-exclamation-triangle"></i> <strong>Note:</strong> This budget appears to be using an older format. Please use the <a href="{{ url_for('budget_wizard', building_id=building.building_id) }}" class="alert-link">Budget Wizard</a> to recreate your budget with detailed operating expense categories.
</div>
{% endif %}

<div class="card shadow">
    <div class="card-body">
        <div class="table-container">
            <table class="table table-bordered table-hover budget-table" id="budgetTable">
                <thead>
                    <tr>
                        <th class="category-header">Category</th>
                        {% for month in months %}
                        <th class="text-end">{{ month|month_name }}</th>
                        {% endfor %}
                        <th class="text-end bg-light">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in categories %}
                        {% if category == 'Revenue' %}
                            <!-- Revenue Header (Expandable if apartments exist) -->
                            {% if apartments and apartments|length > 0 %}
                            <tr class="expandable-row operating-expenses-total" data-category="Revenue" data-target="revenue-detail">
                                <td class="category-header">
                                    <i class="bi bi-chevron-right expand-icon"></i>
                                    {{ category }}
                                </td>
                                {% for month in months %}
                                <td class="text-end">
                                    <strong class="revenue-month-total" data-month="{{ month.strftime('%Y-%m-%d') }}">$0.00</strong>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="category-total">$0.00</strong>
                                </td>
                            </tr>

                            <!-- Revenue Detail Subcategories (Apartment Rents) -->
                            {% for apartment in apartments %}
                            <tr class="subcategory-row" data-parent="revenue-detail" data-category="Revenue" data-apartment="{{ apartment.APARTMENT_ID or apartment.apartment_id }}">
                                <td class="subcategory-header">
                                    Unit {{ apartment.UNIT_NUMBER or apartment.unit_number }}
                                </td>
                                {% for month in months %}
                                <td class="text-end">
                                    <div class="input-with-autofill">
                                        <input type="number"
                                               class="form-control form-control-sm text-end budget-input revenue-input"
                                               data-category="Revenue"
                                               data-apartment="{{ apartment.APARTMENT_ID or apartment.apartment_id }}"
                                               data-month="{{ month.strftime('%Y-%m-%d') }}"
                                               value="{{ apartment.MONTHLY_RENT or apartment.monthly_rent or 0 }}"
                                               step="0.01">
                                        {% if loop.first %}
                                        <button type="button" class="btn btn-sm btn-outline-primary auto-fill-btn" title="Auto-fill across all months">
                                            <i class="bi bi-arrow-right"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="apartment-total">$0.00</strong>
                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <!-- Regular Revenue Row (no apartments) -->
                            <tr data-category="{{ category }}">
                                <td class="category-header">{{ category }}</td>
                                {% for month in months %}
                                <td class="text-end">
                                    <div class="input-with-autofill">
                                        <input type="number"
                                               class="form-control form-control-sm text-end budget-input"
                                               data-category="{{ category }}"
                                               data-month="{{ month.strftime('%Y-%m-%d') }}"
                                               value="{{ budget_by_category.get(category, {}).get(month, 0)|float }}"
                                               step="0.01">
                                        {% if loop.first %}
                                        <button type="button" class="btn btn-sm btn-outline-primary auto-fill-btn" title="Auto-fill across all months">
                                            <i class="bi bi-arrow-right"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="category-total">$0.00</strong>
                                </td>
                            </tr>
                            {% endif %}
                        {% elif category == 'Operating Expenses' %}
                            <!-- Operating Expenses Header (Expandable) -->
                            <tr class="expandable-row operating-expenses-total" data-category="Operating Expenses" data-target="operating-expenses">
                                <td class="category-header">
                                    <i class="bi bi-chevron-right expand-icon"></i>
                                    {{ category }}
                                </td>
                                {% for month in months %}
                                <td class="text-end">
                                    <strong class="operating-expenses-month-total" data-month="{{ month.strftime('%Y-%m-%d') }}">$0.00</strong>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="category-total">$0.00</strong>
                                </td>
                            </tr>

                            <!-- Operating Expense Subcategories -->
                            {% for subcategory in operating_expense_categories %}
                            <tr class="subcategory-row" data-parent="operating-expenses" data-category="{{ subcategory }}">
                                <td class="subcategory-header">
                                    {{ subcategory }}
                                    {% if subcategory == 'Yardcare' %}
                                    <i class="bi bi-info-circle text-muted"
                                       data-bs-toggle="tooltip"
                                       data-bs-placement="right"
                                       title="Includes both lawn care and snow removal"></i>
                                    {% endif %}
                                </td>
                                {% for month in months %}
                                <td class="text-end">
                                    <div class="input-with-autofill">
                                        <input type="number"
                                               class="form-control form-control-sm text-end budget-input operating-expense-input"
                                               data-category="{{ subcategory }}"
                                               data-month="{{ month.strftime('%Y-%m-%d') }}"
                                               value="{{ budget_by_category.get(subcategory, {}).get(month, 0)|float }}"
                                               step="0.01">
                                        {% if loop.first %}
                                        <button type="button" class="btn btn-sm btn-outline-primary auto-fill-btn" title="Auto-fill across all months">
                                            <i class="bi bi-arrow-right"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="category-total">$0.00</strong>
                                </td>
                            </tr>
                            {% endfor %}
                        {% elif category == 'Debt Service' %}
                            <!-- Debt Service Header (Expandable) -->
                            <tr class="expandable-row operating-expenses-total" data-category="Debt Service" data-target="debt-service">
                                <td class="category-header">
                                    <i class="bi bi-chevron-right expand-icon"></i>
                                    {{ category }}
                                </td>
                                {% for month in months %}
                                <td class="text-end">
                                    <strong class="debt-service-month-total" data-month="{{ month.strftime('%Y-%m-%d') }}">$0.00</strong>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="category-total">$0.00</strong>
                                </td>
                            </tr>

                            <!-- Debt Service Subcategories -->
                            {% for subcategory in debt_service_categories %}
                            <tr class="subcategory-row" data-parent="debt-service" data-category="{{ subcategory }}">
                                <td class="subcategory-header">{{ subcategory }}</td>
                                {% for month in months %}
                                <td class="text-end">
                                    <div class="input-with-autofill">
                                        <input type="number"
                                               class="form-control form-control-sm text-end budget-input debt-service-input"
                                               data-category="{{ subcategory }}"
                                               data-month="{{ month.strftime('%Y-%m-%d') }}"
                                               value="{{ budget_by_category.get(subcategory, {}).get(month, 0)|float }}"
                                               step="0.01">
                                        {% if loop.first %}
                                        <button type="button" class="btn btn-sm btn-outline-primary auto-fill-btn" title="Auto-fill across all months">
                                            <i class="bi bi-arrow-right"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="category-total">$0.00</strong>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <!-- Regular Category Row -->
                            <tr data-category="{{ category }}">
                                <td class="category-header">{{ category }}</td>
                                {% for month in months %}
                                <td class="text-end">
                                    <div class="input-with-autofill">
                                        <input type="number"
                                               class="form-control form-control-sm text-end budget-input {% if category in ['Net Operating Income', 'Cashflow'] %}calculated-field{% endif %}"
                                               data-category="{{ category }}"
                                               data-month="{{ month.strftime('%Y-%m-%d') }}"
                                               value="{{ budget_by_category.get(category, {}).get(month, 0)|float }}"
                                               step="0.01"
                                               {% if category in ['Net Operating Income', 'Cashflow'] %}readonly{% endif %}>
                                        {% if loop.first and category not in ['Net Operating Income', 'Cashflow'] %}
                                        <button type="button" class="btn btn-sm btn-outline-primary auto-fill-btn" title="Auto-fill across all months">
                                            <i class="bi bi-arrow-right"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                                {% endfor %}
                                <td class="text-end bg-light">
                                    <strong class="category-total">$0.00</strong>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

        <div class="mt-3">
            <button id="saveBudgetBottom" class="btn btn-primary">
                <i class="bi bi-save"></i> Save Budget
            </button>
        </div>
    </div>

    <!-- Documents Tab -->
    <div class="tab-pane fade {% if active_tab == 'documents' %}show active{% endif %}"
         id="documents"
         role="tabpanel"
         aria-labelledby="documents-tab">

        <div class="row mb-4">
            <div class="col">
                <h3>Building Documents</h3>
                <p class="text-muted">Essential documents for property management and compliance</p>
            </div>
            <div class="col-auto">
                <a href="{{ url_for('upload_document', building_id=building.building_id) }}" class="btn btn-primary">
                    <i class="bi bi-upload"></i> Upload Document
                </a>
            </div>
        </div>

        <!-- Required Documents Section -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-folder-check"></i> Required Documents</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 documents-table">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 40px;">Status</th>
                                <th>Document Type</th>
                                <th>Filename</th>
                                <th>Effective Date</th>
                                <th>End Date</th>
                                <th>Uploaded</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category in required_documents %}
                            {% set doc_list = docs_by_category.get(category, []) %}
                            {% set has_doc = doc_list|length > 0 %}
                            {% set doc = doc_list[0] if has_doc else none %}
                            <tr class="{% if not has_doc %}table-warning{% endif %}">
                                <td class="text-center">
                                    {% if has_doc %}
                                        <i class="bi bi-check-circle-fill text-success" style="font-size: 1.25rem;" title="Uploaded"></i>
                                    {% else %}
                                        <i class="bi bi-x-circle-fill text-danger" style="font-size: 1.25rem;" title="Missing"></i>
                                    {% endif %}
                                </td>
                                <td>
                                    <strong>{{ category }}</strong>
                                </td>
                                <td>
                                    {% if has_doc %}
                                        <i class="bi bi-file-earmark-text text-primary"></i>
                                        {{ doc.filename }}
                                    {% else %}
                                        <span class="text-muted fst-italic">Not uploaded</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if has_doc and doc.effective_date %}
                                        {{ doc.effective_date.strftime('%Y-%m-%d') }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if has_doc and doc.end_date %}
                                        {% set is_expiring_soon = (doc.end_date - now()).days <= 30 if doc.end_date else false %}
                                        <span class="{% if is_expiring_soon %}text-danger fw-bold{% endif %}">
                                            {{ doc.end_date.strftime('%Y-%m-%d') }}
                                            {% if is_expiring_soon %}
                                                <i class="bi bi-exclamation-triangle-fill" title="Expiring soon"></i>
                                            {% endif %}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if has_doc and doc.uploaded_at %}
                                        {{ doc.uploaded_at.strftime('%Y-%m-%d') }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    {% if has_doc %}
                                        <div class="btn-group btn-group-sm">
                                            <a href="{{ url_for('download_document', document_id=doc.document_id) }}"
                                               class="btn btn-outline-primary"
                                               title="Download">
                                                <i class="bi bi-download"></i>
                                            </a>
                                            <a href="{{ url_for('upload_document', building_id=building.building_id) }}?category={{ category }}"
                                               class="btn btn-outline-secondary"
                                               title="Replace">
                                                <i class="bi bi-arrow-repeat"></i>
                                            </a>
                                            <form method="POST"
                                                  action="{{ url_for('delete_document', document_id=doc.document_id) }}"
                                                  style="display: inline;"
                                                  onsubmit="return confirm('Are you sure you want to delete this document?');">
                                                <button type="submit" class="btn btn-outline-danger btn-sm" title="Delete">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    {% else %}
                                        <a href="{{ url_for('upload_document', building_id=building.building_id) }}?category={{ category }}"
                                           class="btn btn-sm btn-primary">
                                            <i class="bi bi-upload"></i> Upload
                                        </a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Optional Documents Section -->
        {% set optional_categories = [] %}
        {% for category in document_categories %}
            {% if category not in required_documents %}
                {% set _ = optional_categories.append(category) %}
            {% endif %}
        {% endfor %}

        {% set has_optional_docs = false %}
        {% for category in optional_categories %}
            {% if category in docs_by_category %}
                {% set has_optional_docs = true %}
            {% endif %}
        {% endfor %}

        {% if has_optional_docs %}
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-folder-plus"></i> Additional Documents</h5>
            </div>
            <div class="card-body">
                {% for category in optional_categories %}
                    {% if category in docs_by_category %}
                    <div class="category-section mb-4">
                        <h6 class="text-primary"><i class="bi bi-folder"></i> {{ category }}</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Filename</th>
                                        <th>Effective Date</th>
                                        <th>End Date</th>
                                        <th>Uploaded</th>
                                        <th class="text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for doc in docs_by_category[category] %}
                                    <tr>
                                        <td>
                                            <i class="bi bi-file-earmark-text text-primary"></i>
                                            {{ doc.filename }}
                                        </td>
                                        <td>
                                            {% if doc.effective_date %}
                                                {{ doc.effective_date.strftime('%Y-%m-%d') }}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if doc.end_date %}
                                                {{ doc.end_date.strftime('%Y-%m-%d') }}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if doc.uploaded_at %}
                                                {{ doc.uploaded_at.strftime('%Y-%m-%d') }}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            <div class="btn-group btn-group-sm">
                                                <a href="{{ url_for('download_document', document_id=doc.document_id) }}"
                                                   class="btn btn-outline-primary"
                                                   title="Download">
                                                    <i class="bi bi-download"></i>
                                                </a>
                                                <form method="POST"
                                                      action="{{ url_for('delete_document', document_id=doc.document_id) }}"
                                                      style="display: inline;"
                                                      onsubmit="return confirm('Are you sure you want to delete this document?');">
                                                    <button type="submit" class="btn btn-outline-danger btn-sm" title="Delete">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="alert alert-info mt-4">
            <i class="bi bi-info-circle"></i>
            <strong>Document Guidelines:</strong>
            <ul class="mb-0 mt-2">
                <li><strong>Insurance Policy:</strong> Upload current property and liability insurance with effective and expiration dates</li>
                <li><strong>Settlement Statement:</strong> Purchase documents from property acquisition</li>
                <li><strong>Fuel Contract:</strong> Heating fuel supply agreements with contract periods</li>
                <li><strong>Property Management Agreement:</strong> Current management company contract</li>
                <li><strong>Loan Agreement:</strong> Primary mortgage or loan documentation</li>
            </ul>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{{ url_for('view_building', building_id=building.building_id) }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Building
    </a>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/budget.js') }}"></script>
<script>
    const buildingId = "{{ building.building_id }}";
    const saveUrl = "{{ url_for('save_budget', building_id=building.building_id) }}";

    $(document).ready(function() {
        initBudget(buildingId, saveUrl);
    });
</script>
{% endblock %}
