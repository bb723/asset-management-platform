{% extends "base.html" %}

{% block title %}{{ entity.name }} - Asset Management Platform{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1><i class="bi bi-building"></i> {{ entity.name }}</h1>
        <p class="text-muted">{{ entity.description or 'No description' }}</p>
    </div>
    <div class="col-auto">
        <div class="btn-group" role="group">
            <a href="{{ url_for('edit_entity', entity_id=entity.entity_id) }}" class="btn btn-secondary">
                <i class="bi bi-pencil"></i> Edit
            </a>
            <a href="{{ url_for('entity_budget', entity_id=entity.entity_id) }}" class="btn btn-success">
                <i class="bi bi-currency-dollar"></i> Budget
            </a>
            <a href="{{ url_for('create_building', entity_id=entity.entity_id) }}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Add Building
            </a>
        </div>
    </div>
</div>

<!-- Shareable Link -->
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-share"></i> Shareable Link
    </div>
    <div class="card-body">
        {% if share_token %}
        <div class="input-group">
            <input type="text" class="form-control" id="shareUrl" value="{{ url_for('shared_view', token=share_token, _external=True) }}" readonly>
            <button class="btn btn-outline-secondary" type="button" onclick="copyShareLink()">
                <i class="bi bi-clipboard"></i> Copy
            </button>
        </div>
        <small class="text-muted">Anyone with this link can view the entity and budget (read-only)</small>
        {% else %}
        <p>No shareable link exists for this entity.</p>
        <a href="{{ url_for('generate_share_link', entity_id=entity.entity_id) }}" class="btn btn-primary">
            <i class="bi bi-share"></i> Generate Shareable Link
        </a>
        {% endif %}
    </div>
</div>

<!-- Buildings -->
<div class="card shadow">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-houses"></i> Buildings ({{ buildings|length }})</h5>
    </div>
    <div class="card-body">
        {% if buildings %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Address</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for building in buildings %}
                    <tr>
                        <td>
                            <a href="{{ url_for('view_building', building_id=building.building_id) }}">
                                {{ building.name }}
                            </a>
                        </td>
                        <td>{{ building.address or '-' }}</td>
                        <td>{{ building.created_at.strftime('%Y-%m-%d') if building.created_at else '-' }}</td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{{ url_for('view_building', building_id=building.building_id) }}" class="btn btn-outline-primary">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a href="{{ url_for('edit_building', building_id=building.building_id) }}" class="btn btn-outline-secondary">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{{ url_for('view_budget', building_id=building.building_id) }}" class="btn btn-outline-success">
                                    <i class="bi bi-currency-dollar"></i>
                                </a>
                                <a href="{{ url_for('view_documents', building_id=building.building_id) }}" class="btn btn-outline-info">
                                    <i class="bi bi-file-earmark"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No buildings found. <a href="{{ url_for('create_building', entity_id=entity.entity_id) }}">Add your first building</a>.
        </div>
        {% endif %}
    </div>
</div>

<div class="mt-3">
    <a href="{{ url_for('home') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Entities
    </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyShareLink() {
    const shareUrl = document.getElementById('shareUrl');
    shareUrl.select();
    shareUrl.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(shareUrl.value);
    alert('Link copied to clipboard!');
}
</script>
{% endblock %}
